<!DOCTYPE HTML>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Your Website</title>
  <link rel="stylesheet" type="text/css" href="css/reset.css">
  <link rel="stylesheet" type="text/css" href="css/app.css">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
  <script src="js/jquery.nicescroll.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/js/select2.min.js"></script>


</head>

<body>

  <div id="map"></div>

  <div class="box">
    <div class="box-inner">
      <div class="box-header">
        <div class="box-select">
          <h2 class="box-selectTitle">CHOOSE A MEASUREMENT</h2>
          <div class="box-input">
            <h2 class="js-box-input">All</h2>
          </div>
        </div>  
        <div class="box-select">
          <h2 class="box-selectTitle js-box-selectTitle">MALE POPULATION</h2>
          <div class="box-selectInfo">
            <h3 class="box-figure js-figure">256,982</h3>
            <p class="box-figureInfo"><span class="js-percent">45</span>% of total (<span class="js-total">545,065</span>)</p>
          </div>
        </div>
      </div>
      <div class="box-container is-hidden">
        <nav class="box-nav"></nav>
        <div class="box-result">
      </div>
    </div>
  </div>
  <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>

  <script type="text/javascript">

    $( document ).ready(function() {
      cartodb.createVis('map', 'https://team.cartodb.com/u/piensaenpixel/api/v2/viz/3ae0b708-136b-11e6-97d4-0ea31932ec1d/viz.json');

      /* read json */
      var subitemsMenu = function(e,f){
        var id = $(e).attr("data-value")
        var obj = f[id];
        var j = obj.filter_1;
        var subitems = [];
        $.each( j, function( k, val ) {
          subitems.push( "<li id='dataSubitem_" + k + "'><a href='#'>" + val.label_1 + "</a></li>" );
        });

        $( ".js-result-category" ).empty();
        $( "<ul/>", {
          "class": "box-resultList js-result-category",
          html: subitems.join( "" ),
        }).appendTo(".box-result");
      };
      var clickSubitem = function(){
        $( ".js-result-category li" ).on( "click", function() {
          $(".js-result-category li").removeClass( "is-selected" );
          $(this).toggleClass( "is-selected" );
          $(".js-box-selectTitle").text($(this).text());
        }); 


      };
      var scrollFunction = function(){
        $(".js-result-category").niceScroll({
          cursorcolor: "#ccc", // change cursor color in hex
          cursorwidth: "4px"
        });
      };
      $.getJSON( "data.json", function( data ) {
        var items = [];
        $.each( data, function( key, val ) {
            if (items.length == 0) {
              items.push( "<li><a class='is-selected' href='#' data-value='" + key + "'>" + val.label + "</a></li>" );
            } else {
              items.push( "<li><a href='#' data-value='" + key + "'>" + val.label + "</a></li>" );
            }     
        });
        $( "<ul/>", {
          "class": "box-navNavigation",
          html: items.join( "" )
        }).appendTo( ".box-nav" );
        subitemsMenu($( ".box-navNavigation a" ), data);
      })
        .done(function(data){
          $( ".box-navNavigation a" ).on( "click", function() {
            var txt = $(this).text();
            $(".js-box-input").text(txt);
            $(".box-navNavigation a").removeClass( "is-selected" );
            $(this).toggleClass( "is-selected" );
            subitemsMenu(this, data);
            clickSubitem();
            scrollFunction();
          });
          clickSubitem();
          scrollFunction();
        })


      $( ".box-input" ).on( "click", function() {
        $(this).toggleClass( "is-open" );
        $(".box-container").toggleClass( "is-hidden" );
      });
    });

  </script>

</body>

</html>